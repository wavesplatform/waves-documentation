# Конфигурация ноды

> После обновления до версии 1.0.2 обратите внимание: если файл `/etc/waves/waves.conf` был изначально скопирован из шаблона, то нужно проверить, что в параметре `waves.directory` указана правильная папка. Если этой опции нет в конфигурационном файле, будет использоваться папка по умолчанию.

## Формат конфигурации

В системе конфигурации ноды Waves применяется формат HOCON (Human-Optimized Config Object Notation). Подробное описание HOCON доступно по ссылке [Official HOCON documentation](https://github.com/typesafehub/config/blob/master/HOCON.md). Преимущества HOCON — это простой синтаксис и возможность использовать комментарии.

## Стандартные файлы конфигурации и ручные настройки

### Стандартный файл конфигурации, вложенный в JAR

Стандартный файл конфигурации ноды Waves, вложенный в файл JAR, доступен по ссылке:

https://github.com/wavesplatform/Waves/blob/master/node/src/main/resources/application.conf

### Файлы конфигурации Mainnet и Testnet в пакетах DEB

Установочные пакеты DEB содержат файлы конфигурации, которые переопределяют некоторые параметры, специфичные для сети:

* https://github.com/wavesplatform/Waves/blob/master/node/waves-mainnet.conf
* https://github.com/wavesplatform/Waves/blob/master/node/waves-testnet.conf

### Переопределение параметров при запуске файлa JAR

При запуске файла JAR рекомендуется переопределять назначенные по умолчанию параметры, вписав адрес файла конфигурации через командную строку при запуске приложения ноды Waves.

```
java -jar waves-all-0.13.3.jar waves.conf
```

Обычно файл содержит уникальные характеристики вашей ноды (IP-адрес, имя, ключи и прочее) и параметры, специфичные для сети, аналогично файлам конфигурации `waves-mainnet` или `waves-testnet` из пакетов DEB, описанным выше.

## Секции конфигурации

### Секция конфигурации Waves

Корневая секция `waves` содержит ключевые параметры и прочие конфигурационные подсекции.

С помощью параметра `directory` можно назначить путь к основной папке приложения. В настройках параметров конфигурации можно использовать переменные среды (environment variables). Пожалуйста, не заключайте переменные среды в кавычки: в этом случае они будут обработаны как строки и не будут применены.

Убедитесь, что для выбранной папки корректно указан owner: `waves` для Mainnet и `waves-testnet` для Testnet.

По умолчанию в зависимости от операционной системы и типа блокчейна используются следующие папки:

| | *nix | macOS | Windows |
| :--- | :--- | :--- | :--- |
| Mainnet | `$XDG_DATA_HOME/waves-mainnet` или `$HOME/.local/share/waves-mainnet` | `$HOME/Library/Application Support/waves-mainnet` | `$LOCALAPPDATA/waves-mainnet` |
| Testnet | `$XDG_DATA_HOME/waves-testnet` или `$HOME/.local/share/waves-testnet` | `$HOME/Library/Application Support/waves-testnet` | `$LOCALAPPDATA/waves-testnet` |
| Stagenet | `$XDG_DATA_HOME/waves-stagenet` или `$HOME/.local/share/waves-stagenet` | `$HOME/Library/Application Support/waves-stagenet` | `$LOCALAPPDATA/waves-stagenet` |
| Custom | `$XDG_DATA_HOME/waves-custom-<character>*` или `$HOME/.local/share/waves-custom-<character>*` | `$HOME/Library/Application Support/waves-custom-<character>*` | `$LOCALAPPDATA/waves-custom-<character>*` |

\* См. описание параметра `address-scheme-character` в настройках собственного блокчейна.

Параметр `data-directory` задает расположение папки базы данных LevelDB. В этой базе данных содержатся данные блокчейна и состояние.

Параметр `leveldb-cache-size` задает размер внутреннего кэша базы данных LevelDB. Размер кэша указывается в байтах или с использованием единиц измерения:
* K — килобайт
* M — мегабайт
* G — гигабайт

### Настройки сети

В секции `network` можно настроить параметры P2P-сети.

Используйте параметр `file`, чтобы задать расположение базы данных узлов. В этой базе данных хранится список известных и заблокированных узлов. По умолчанию этот путь задан относительно основной папки `directory` в секции `waves`.

Используйте параметр `declared-address`, чтобы назначить внешний IP-адрес и номер порта ноды. Это важно для работы NAT большинства облачных хостингов, где компьютер напрямую не взаимодействует с внешним адресом. Если не задать данный параметр, то нода сможет подключиться к P2P-сети, но не сможет принимать входящие подключения, поэтому другие ноды не смогут подключиться. Другие ноды подключаются к вашей ноде, используя эти данные. Параметр следует задавать в формате "[ip-address]:[port]".

Используйте параметр `bind-address`, чтобы назначить IP-адрес локальной сети, с которым будет взаимодействовать нода Waves для приема подключений. По умолчанию нода связана с адресом `0.0.0.0`: это означает, что она будет ожидать подключения от всех возможных сетевых адаптеров.

Используйте параметр `port`, чтобы назначить номер сетевого порта, к которому будут подключаться другие ноды Waves. Убедитесь, что порт доступен извне, иначе ваша нода будет подключаться к P2P-сети только через исходящие подключения. Если порт используется другим приложением, нода не запустится.

Параметр `node-name` можно использовать, чтобы назначить имя ноды, которое будет видно другим участникам P2P-сети. Имя передается во время первоначального обмена данными (handshake). По умолчанию этот параметр не задан, и имя генерируется случайным образом.

Параметр `nonce` передается во время первоначального обмена данными (handshake). По умолчанию он не задан и генерируется случайным образом. Данный параметр используется для того, чтобы отличать ноды, подключенные с одного IP-адреса.

Параметр `known-peers` используется для хранения списка bootstrap-нод, с которыми ваша нода будет устанавливать исходящие соединения во время инициализации. По умолчанию заданы ноды Testnet.

Параметр `peers-data-residence-time` применяется, чтобы задать время, в течение которого нода будет хранить информацию о внешних узлах с момента последней сессии подключения.

**Примечание**: Все промежутки времени указываются в миллисекундах либо с использованием единиц измерения:
<ul><li>s — секунды</li><li>m — минуты</li><li>h — часы</li><li>d — дни</li></ul>
С примерами применения можно ознакомиться в стандартном конфигурационном файле выше.

Параметр `black-list-residence-time` применяется, чтобы задать время, в течение которого информация о внешнем узле будет находиться в черном списке.

Параметр `max-inbound-connections` применяется, чтобы задать максимальное количество одновременных входящих подключений к ноде.

Параметр `max-outbound-connections` применяется для ограничения количества исходящих сетевых подключений.

Параметр `max-single-host-connections` применяется, чтобы задать разрешенное количество сетевых подключений с одного IP-адреса.

Параметр `connection-timeout` применяется, чтобы задать таймаут сетевого подключения.

Параметр `outbound-buffer-size` применяется, чтобы задать размер сетевого буфера. Лучше оставить значение по умолчанию. Неправильно заданный размер буфера может привести к неисправности ноды.

Параметр `max-unverified-peers` применяется, чтобы изменить максимальный размер буфера для хранения информации об узлах, полученной во время первоначального обмена данными (handshake).

Параметр `enable-peers-exchange` позволяет включить/выключить запрос и отправку информации про узлы.

Параметр `enable-blacklisting` позволяет включить/выключить черный список узлов.

Параметр `peers-broadcast-interval` позволяет задать время между сеансами передачи списков известных узлов другим нодам.

Параметр `handshake-timeout` позволяет задать время ожидания ответа во время первоначального обмена данными (handshake). Неответивший узел попадет в черный список.

В секции `upnp` можно задать настройки UPnP. Данные настройки нужны только в том случае, если нода Waves запущена в домашней сети, где требуется установка туннельного соединения роутера. По умолчанию данная функциональность выключена. Используйте параметр `enable` в секции `upnp` для включения.

В секции `traffic-logger` можно включить/выключить логирование некоторых исходящих или входящих сообщений. Сетевые сообщения логируются на уровне TRACE.

### Настройки кошелька

В секции `wallet` можно настроить встроенный в ноду кошелек Waves.

Параметр `file` позволяет задать путь до файла кошелька. По умолчанию путь задан относительно основной папки приложения.

Параметр `password` позволяет задать пароль для файла кошелька.

Параметр `seed` позволяет пересоздать кошелек на новой ноде. Укажите SEED-фразу в формате Base58. Если у вас нет кошелька, закомментируйте данный параметр и запустите ноду. Во время первого запуска приложение создаст кошелек со случайной SEED-фразой. В этом случае SEED-фраза отобразится в логе приложения. Если вы потеряете лог или не хотите открывать его, SEED-фразу также можно будет получить с помощью метода `wallet/seed` REST API ноды.

> **Внимание!** Кошелек — критически важный компонент вашей ноды. Храните файл кошелька в безопасном месте. Создайте резервную копию файла.
> Рекомендуем удалить SEED-фразу из файла конфигурации сразу же после запуска ноды. Если злоумышленник получит доступ к вашей SEED-фразе, у него будет доступ ко всем вашим средствам на всех адресах!

#### Обновление настроек кошелька

Чтобы запустить ноду с другим кошельком, используйте один из способов:
* Заменить файл `wallet.dat` другим, в котором хранится SEED-фраза нужного кошелька.
ИЛИ
* Удалите/перенесите файл `wallet.dat`, чтобы папка `wallet` стала пустой. Затем обновите SEDD-фразу в файле конфигурации.

Перезапустите ноду. После перезапуска нода будет использовать настройки другого кошелька.

### Настройки блокчейна

В данной секции можно выбрать тип блокчейна или создать свой собственный блокчейн.

Параметр `max-transactions-per-block-diff` позволяет задать количество транзакций, которые будут храниться в памяти перед сохранением на диск. Уменьшение этого значения может увеличить количество операций записи на диск.

Параметр `min-blocks-in-memory` позволяет изменить количество блоков, которые будут храниться в памяти.

Параметр `type` позволяет выбрать тип блокчейна. Доступные опции: TESTNET, MAINNET, STAGENET и CUSTOM. Для типов MAINNET, TESTNET и STAGENET параметры блокчейна встроены в приложение, поэтому дополнительная настройка не требуется. При выборе блокчейна типа CUSTOM необходимо задать параметры секции `custom` (которая закомментирована в примере).

#### Настройка собственного блокчейна

Параметр `address-scheme-character` в секции `custom` позволяет включить функцию address character. Указанный символ используется при формировании адреса, а также передается по сети во время первичного взаимодействия (handshake). Таким образом, функция позволяет ноде не взаимодействовать с нодами других блокчейнов.

Секция `functionality` позволяет устанавливать временные отметки активации различных валидаций блокчейна. Рекомендуем задать значение 0 для всех функциональностей, чтобы активировать все типы валидаций.

В секции `genesis` необходимо описать первый блок вашего собственного блокчейна.

Параметр `block-timestamp` позволяет задать дату создания блока генезиса.

Параметр `timestamp` позволяет задать время создания транзакций генезиса.

Параметр `signature` позволяет задать подпись блока генезиса.

Параметр `initial-balance` позволяет задать общее количество монет. Это значение следует задавать в наименьших единицах измерения криптовалюты.

Параметр `initial-base-target` позволяет настроить скорость генерации блоков в самом начале вашего блокчейна.

Параметр `average-block-delay` позволяет задать скорость генерации блоков вашего блокчейна. Это промежуток времени между блоками, к которому система будет стремиться. Реальные промежутки между блоками могут отличаться от заданного значения.

В качества параметра `transactions` укажите список транзакций генезиса. Каждая транзакция должна содержать адрес получателя (строка BASE58) и количество. В блоке генезиса необходимо распределить весь первоначальный баланс на один или несколько адресов, иначе блок генезиса будет признан ошибочным и приложение не запустится.

### Настройки майнера

В секции `miner` можно настроить генератор новых блоков.

Параметр `enable` позволяет включить/выключить генерацию блоков нодой. По умолчанию генерация включена, но если ее выключить, то нода не будет генерировать новые блоки.

Параметр `quorum` позволяет задать минимальное количество подключенных узлов, необходимых для майнинга новых блоков. По умолчанию задано значение 1. Это означает, что ваша нода начнет майнинг сразу, как только подключится к первому узлу P2P-сети. Если задать значение 0, то активируется офлайн-генерация.

Параметр `interval-after-last-block-then-generation-is-allowed` позволяет настроить алгоритм загрузки и генерации блоков. По умолчанию задано значение 1 день. Это означает, что ваша нода не начнет генерацию, если последний блок локального блокчейна старше 1 дня. Используя данный параметр, вы даете команду ноде актуализировать блокчейн перед началом генерации новых блоков. Это применимо только после длительных отключений ноды.

### Настройки REST API

Секция **REST API** файла конфигурации ноды содержит настройки [Node API](/waves-node/node-api.md).

| # | Name | Description | Default value |
| :--- | :--- | :--- | :--- |
| 1 | enable | Активирует REST API. <br>Для деактивации REST API укажите значение `no`. | yes |
| 2 | `bind-address` | Назначает сетевой адрес, по которому REST API будет принимать входящие подключения. <br>**Примечание**. Не рекомендуется менять значение по умолчанию. Используйте [Nginx’s proxy pass module](http://nginx.org/ru/docs/http/ngx_http_proxy_module.html) или [SSH port forwarding](http://blog.trackets.com/2014/05/17/ssh-tunnel-local-and-remote-port-forwarding-explained-with-examples.html)  для внешнего доступа. | `"127.0.0.1"` |
| 3 | `port` | Назначает номер порта, через который REST API будет ожидать подключения. | 6869 |
| 4 | `api-key-hash` | Задает хэш [API key](https://en.wikipedia.org/wiki/Application_programming_interface_key), который предоставляется владельцем ноды.<br> API key владельца ноды — очень важный параметр, так же как и [SEED-фраза](/waves-client/frequently-asked-questions-faq/account-management/seed-phrase.md) и пароль кошелька.<br>Для генерации хэша API key:<br> 1. Перейдите в [Swagger web interface](/waves-node/node-api.md).<br>2. Нажмите на секцию [`utils`](https://nodes.wavesnodes.com/api-docs/index.html#/utils).<br>3. Нажмите на метод [`/utils/hash/secure`](https://nodes.wavesnodes.com/api-docs/index.html#!/utils/hashSecure_1).<br>4. Создайте уникальную строку API key и включите ее в параметр `message`.<br> 5. Скопируйте хэш API key и вставьте его в файл конфигурации ноды.<br>6. Перезапустите ноду.<br>**Внимание!** API key передается в HTTP-заголовке в открытом виде. Злоумышленники могут перехватить его в процессе передачи по сети и использовать для перевода ваших средств на любой адрес. Очень важно защитить передачу данных с помощью HTTPS- или SSH-ретрансляции порта. | "" |
| 5 | cors | Включает поддержку [CORS](https://en.wikipedia.org/wiki/Cross-origin_resource_sharing), которая важна для [Swagger](https://swagger.io/) и [Exchange](https://waves.exchange). <br>CORS позволяет безопасно получать запросы для других доменов, вне того, на котором работает нода. Для выключения поддержки CORS установите значение `no`. | yes |

**Примечание**. В запросах к REST API ноды нужно указывать сам [API key](https://en.wikipedia.org/wiki/Application_programming_interface_key), а не его хэш.

Пример подписи транзакции, которая уже существует в кошельке владельца ноды в виде команды curl:

```
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' --header 'X-API-Key: YOUR UNIQUE API KEY'
-d '{ \
amount: 5800000000, \
fee: 100000, \
type: 4, \
version: 1, \
attachment: "", \
sender: "3P3pUKEAKxegWr3PZkGYNq1mzQQaQ5zxZbw", \
feeAssetId: null, \
assetId: null, \
recipient: "3P9p39MwZ5JjwdBSYEWC6XYri4jpovzcAbs", \
feeAsset: null, \
timestamp: 1568020044350 \
}' 'http://nodes.wavesnodes.com/transactions/sign'
```

### Настройки синхронизации

В секции `synchronisation` можно настраивать различные аспекты процесса синхронизации ноды.

Параметр `max-rollback` позволяет задать количество блоков, которые будут сброшены в случае обнаружения форка. Если нода обнаружит форк с более низким score, она попытается переключиться на другой форк, для этого нода откатится на несколько блоков. Если обнаруженный форк длиннее заданного значения параметра, нода не будет переключаться, даже если score другого форка выше.

Параметр `max-chain-length` позволяет задать размер буфера для хранения блоков обнаруженного форка. Размер должен быть больше, чем максимальная длина форка.

Параметр `synchronization-timeout` позволяет задать таймаут операции загрузки блока.

Параметр `score-broadcast-interval` позволяет задать интервал между публикациями score в P2P-cети.

Параметр `score-ttl` позволяет задать интервал time-to-live публикуемых пакетов score.

Параметр `remote-score-debounce` позволяет задать время ожидания получения следующего обновления данных score от других узлов.

В подсекции `history-replier` можно задать количество последних блоков и микроблоков, которые будут кешироваться в памяти.

В подсекции `micro-block-synchronizer` можно настроить различные параметры протокола Waves-NG.

### Настройки UTX pool

В данной секции можно настроить размер пула неподтвержденных транзакций (параметр `max-size`) и максимальный допустимый возраст неподтвержденных транзакций (`max-transaction-age`).

<a id="rewards"></a>
### Настройки вознаграждения

В данной секции вы можете указать желаемый размер вознаграждения за майнинг в параметре `desired`. Значение указывается в [WAVELET](/blockchain/token/wavelet.md).

Если значение больше текущего размера вознаграждения, то майнер голосует за увеличение вознаграждения; если меньше — за уменьшение.

Пример: желаемый размер вознаграждения 7 WAVES:

```js
waves {
  rewards {
    desired = 700000000
  }
}  
```

В качестве значения может быть указано любое целое число в диапазоне от 0 до 9 223 372 036 854 775 807 включительно.
Отрицательные значения игнорируются.

Подробнее см. в разделе [Вознаграждение за майнинг](/blockchain/mining/mining-reward.md).
